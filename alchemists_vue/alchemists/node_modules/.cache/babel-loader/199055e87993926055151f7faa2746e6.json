{"ast":null,"code":"import { errorMonitor } from 'events';\nimport { types } from 'util';\nimport deferToConnect from 'defer-to-connect';\n\nconst timer = request => {\n  if (request.timings) {\n    return request.timings;\n  }\n\n  const timings = {\n    start: Date.now(),\n    socket: undefined,\n    lookup: undefined,\n    connect: undefined,\n    secureConnect: undefined,\n    upload: undefined,\n    response: undefined,\n    end: undefined,\n    error: undefined,\n    abort: undefined,\n    phases: {\n      wait: undefined,\n      dns: undefined,\n      tcp: undefined,\n      tls: undefined,\n      request: undefined,\n      firstByte: undefined,\n      download: undefined,\n      total: undefined\n    }\n  };\n  request.timings = timings;\n\n  const handleError = origin => {\n    origin.once(errorMonitor, () => {\n      timings.error = Date.now();\n      timings.phases.total = timings.error - timings.start;\n    });\n  };\n\n  handleError(request);\n\n  const onAbort = () => {\n    timings.abort = Date.now();\n    timings.phases.total = timings.abort - timings.start;\n  };\n\n  request.prependOnceListener('abort', onAbort);\n\n  const onSocket = socket => {\n    timings.socket = Date.now();\n    timings.phases.wait = timings.socket - timings.start;\n\n    if (types.isProxy(socket)) {\n      return;\n    }\n\n    const lookupListener = () => {\n      timings.lookup = Date.now();\n      timings.phases.dns = timings.lookup - timings.socket;\n    };\n\n    socket.prependOnceListener('lookup', lookupListener);\n    deferToConnect(socket, {\n      connect: () => {\n        timings.connect = Date.now();\n\n        if (timings.lookup === undefined) {\n          socket.removeListener('lookup', lookupListener);\n          timings.lookup = timings.connect;\n          timings.phases.dns = timings.lookup - timings.socket;\n        }\n\n        timings.phases.tcp = timings.connect - timings.lookup;\n      },\n      secureConnect: () => {\n        timings.secureConnect = Date.now();\n        timings.phases.tls = timings.secureConnect - timings.connect;\n      }\n    });\n  };\n\n  if (request.socket) {\n    onSocket(request.socket);\n  } else {\n    request.prependOnceListener('socket', onSocket);\n  }\n\n  const onUpload = () => {\n    timings.upload = Date.now();\n    timings.phases.request = timings.upload - (timings.secureConnect ?? timings.connect);\n  };\n\n  if (request.writableFinished) {\n    onUpload();\n  } else {\n    request.prependOnceListener('finish', onUpload);\n  }\n\n  request.prependOnceListener('response', response => {\n    timings.response = Date.now();\n    timings.phases.firstByte = timings.response - timings.upload;\n    response.timings = timings;\n    handleError(response);\n    response.prependOnceListener('end', () => {\n      request.off('abort', onAbort);\n      response.off('aborted', onAbort);\n\n      if (timings.phases.total) {\n        // Aborted or errored\n        return;\n      }\n\n      timings.end = Date.now();\n      timings.phases.download = timings.end - timings.response;\n      timings.phases.total = timings.end - timings.start;\n    });\n    response.prependOnceListener('aborted', onAbort);\n  });\n  return timings;\n};\n\nexport default timer;","map":{"version":3,"names":["errorMonitor","types","deferToConnect","timer","request","timings","start","Date","now","socket","undefined","lookup","connect","secureConnect","upload","response","end","error","abort","phases","wait","dns","tcp","tls","firstByte","download","total","handleError","origin","once","onAbort","prependOnceListener","onSocket","isProxy","lookupListener","removeListener","onUpload","writableFinished","off"],"sources":["E:/web/alchemists_vue/alchemists/node_modules/@szmarczak/http-timer/dist/source/index.js"],"sourcesContent":["import { errorMonitor } from 'events';\nimport { types } from 'util';\nimport deferToConnect from 'defer-to-connect';\nconst timer = (request) => {\n    if (request.timings) {\n        return request.timings;\n    }\n    const timings = {\n        start: Date.now(),\n        socket: undefined,\n        lookup: undefined,\n        connect: undefined,\n        secureConnect: undefined,\n        upload: undefined,\n        response: undefined,\n        end: undefined,\n        error: undefined,\n        abort: undefined,\n        phases: {\n            wait: undefined,\n            dns: undefined,\n            tcp: undefined,\n            tls: undefined,\n            request: undefined,\n            firstByte: undefined,\n            download: undefined,\n            total: undefined,\n        },\n    };\n    request.timings = timings;\n    const handleError = (origin) => {\n        origin.once(errorMonitor, () => {\n            timings.error = Date.now();\n            timings.phases.total = timings.error - timings.start;\n        });\n    };\n    handleError(request);\n    const onAbort = () => {\n        timings.abort = Date.now();\n        timings.phases.total = timings.abort - timings.start;\n    };\n    request.prependOnceListener('abort', onAbort);\n    const onSocket = (socket) => {\n        timings.socket = Date.now();\n        timings.phases.wait = timings.socket - timings.start;\n        if (types.isProxy(socket)) {\n            return;\n        }\n        const lookupListener = () => {\n            timings.lookup = Date.now();\n            timings.phases.dns = timings.lookup - timings.socket;\n        };\n        socket.prependOnceListener('lookup', lookupListener);\n        deferToConnect(socket, {\n            connect: () => {\n                timings.connect = Date.now();\n                if (timings.lookup === undefined) {\n                    socket.removeListener('lookup', lookupListener);\n                    timings.lookup = timings.connect;\n                    timings.phases.dns = timings.lookup - timings.socket;\n                }\n                timings.phases.tcp = timings.connect - timings.lookup;\n            },\n            secureConnect: () => {\n                timings.secureConnect = Date.now();\n                timings.phases.tls = timings.secureConnect - timings.connect;\n            },\n        });\n    };\n    if (request.socket) {\n        onSocket(request.socket);\n    }\n    else {\n        request.prependOnceListener('socket', onSocket);\n    }\n    const onUpload = () => {\n        timings.upload = Date.now();\n        timings.phases.request = timings.upload - (timings.secureConnect ?? timings.connect);\n    };\n    if (request.writableFinished) {\n        onUpload();\n    }\n    else {\n        request.prependOnceListener('finish', onUpload);\n    }\n    request.prependOnceListener('response', (response) => {\n        timings.response = Date.now();\n        timings.phases.firstByte = timings.response - timings.upload;\n        response.timings = timings;\n        handleError(response);\n        response.prependOnceListener('end', () => {\n            request.off('abort', onAbort);\n            response.off('aborted', onAbort);\n            if (timings.phases.total) {\n                // Aborted or errored\n                return;\n            }\n            timings.end = Date.now();\n            timings.phases.download = timings.end - timings.response;\n            timings.phases.total = timings.end - timings.start;\n        });\n        response.prependOnceListener('aborted', onAbort);\n    });\n    return timings;\n};\nexport default timer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}